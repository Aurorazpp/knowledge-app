<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#4F46E5">
  <meta name="description" content="ä¸ªäººçŸ¥è¯†ç®¡ç†åº”ç”¨">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="æˆ‘çš„çŸ¥è¯†åº“">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3EğŸ“š%3C/text%3E%3C/svg%3E">
  <title>æˆ‘çš„çŸ¥è¯†åº“</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft YaHei", sans-serif;
      background: linear-gradient(135deg, #EFF6FF 0%, #E0E7FF 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .install-banner {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #4F46E5;
      color: white;
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.3);
      z-index: 1000;
      display: none;
      align-items: center;
      gap: 12px;
      animation: slideUp 0.3s ease;
    }

    .install-banner.show {
      display: flex;
    }

    @keyframes slideUp {
      from { transform: translateX(-50%) translateY(100px); opacity: 0; }
      to { transform: translateX(-50%) translateY(0); opacity: 1; }
    }

    .install-btn {
      background: white;
      color: #4F46E5;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }

    .close-banner {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 0 8px;
    }

    .header {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      padding: 30px;
      margin-bottom: 24px;
    }

    h1 {
      font-size: 32px;
      color: #1F2937;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .subtitle {
      color: #6B7280;
      font-size: 14px;
      margin-bottom: 20px;
    }

    .search-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin-bottom: 20px;
    }

    .input-group {
      position: relative;
    }

    input, select {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #E5E7EB;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #4F46E5;
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }

    .btn {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: #4F46E5;
      color: white;
    }

    .btn-primary:hover {
      background: #4338CA;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
    }

    .btn-success {
      background: #10B981;
      color: white;
    }

    .btn-success:hover {
      background: #059669;
    }

    .btn-success:disabled {
      background: #D1D5DB;
      cursor: not-allowed;
    }

    .form-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      padding: 30px;
      margin-bottom: 24px;
    }

    .form-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 24px;
      color: #6B7280;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .close-btn:hover {
      color: #1F2937;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #374151;
      margin-bottom: 8px;
    }

    textarea {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #E5E7EB;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      resize: vertical;
      min-height: 120px;
    }

    textarea:focus {
      outline: none;
      border-color: #4F46E5;
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }

    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .record-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 24px;
      margin-bottom: 16px;
      transition: all 0.3s;
    }

    .record-card:hover {
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
      transform: translateY(-2px);
    }

    .record-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .record-title {
      font-size: 20px;
      font-weight: 600;
      color: #1F2937;
      margin-bottom: 8px;
    }

    .record-meta {
      display: flex;
      gap: 12px;
      font-size: 14px;
      color: #6B7280;
      flex-wrap: wrap;
    }

    .category-tag {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .cat-math { background: #DBEAFE; color: #1E40AF; }
    .cat-language { background: #D1FAE5; color: #065F46; }
    .cat-cooking { background: #FED7AA; color: #9A3412; }
    .cat-tech { background: #E9D5FF; color: #6B21A8; }
    .cat-other { background: #F3F4F6; color: #374151; }

    .record-content {
      color: #374151;
      line-height: 1.6;
      white-space: pre-wrap;
      margin-bottom: 12px;
    }

    .record-files {
      background: #F9FAFB;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      color: #6B7280;
    }

    .delete-btn {
      background: none;
      border: none;
      color: #EF4444;
      cursor: pointer;
      padding: 8px;
      border-radius: 6px;
      transition: all 0.3s;
    }

    .delete-btn:hover {
      background: #FEE2E2;
      color: #DC2626;
    }

    .empty-state {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 48px;
      text-align: center;
      color: #6B7280;
    }

    .stats {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 16px;
      text-align: center;
      color: #6B7280;
      margin-top: 24px;
    }

    .stats strong {
      color: #4F46E5;
      font-size: 18px;
    }

    .hidden {
      display: none;
    }

    @media (max-width: 768px) {
      .grid-2 {
        grid-template-columns: 1fr;
      }
      
      .search-grid {
        grid-template-columns: 1fr;
      }

      .install-banner {
        left: 10px;
        right: 10px;
        transform: none;
        width: calc(100% - 20px);
      }
    }
  </style>
</head>
<body>
  <!-- PWAå®‰è£…æç¤º -->
  <div class="install-banner" id="installBanner">
    <span>ğŸ“± å®‰è£…åˆ°æ¡Œé¢ï¼Œéšæ—¶ä½¿ç”¨ï¼</span>
    <button class="install-btn" id="installButton">ç«‹å³å®‰è£…</button>
    <button class="close-banner" id="closeBanner">Ã—</button>
  </div>

  <div class="container">
    <!-- å¤´éƒ¨ -->
    <div class="header">
      <h1>ğŸ“š æˆ‘çš„çŸ¥è¯†åº“</h1>
      <p class="subtitle">âœ¨ PWAåº”ç”¨ - å¯å®‰è£…åˆ°æ¡Œé¢ä½¿ç”¨</p>
      
      <div class="search-grid">
        <input type="text" id="searchInput" placeholder="ğŸ” æœç´¢æ ‡é¢˜æˆ–å†…å®¹...">
        <select id="categoryFilter">
          <option value="all">æ‰€æœ‰åˆ†ç±»</option>
          <option value="math">æ•°å­¦</option>
          <option value="language">è¯­è¨€å­¦ä¹ </option>
          <option value="cooking">çƒ¹é¥ª</option>
          <option value="tech">æŠ€æœ¯</option>
          <option value="other">å…¶ä»–</option>
        </select>
        <input type="date" id="dateFilter">
      </div>

      <button class="btn btn-primary" onclick="toggleForm()">
        â• æ·»åŠ æ–°è®°å½•
      </button>
    </div>

    <!-- æ·»åŠ è¡¨å• -->
    <div id="formCard" class="form-card hidden">
      <div class="form-header">
        <h2>æ–°å»ºè®°å½•</h2>
        <button class="close-btn" onclick="toggleForm()">Ã—</button>
      </div>

      <div class="form-group">
        <label>æ ‡é¢˜</label>
        <input type="text" id="titleInput" placeholder="ä¾‹å¦‚ï¼šå‹¾è‚¡å®šç†">
      </div>

      <div class="form-group">
        <label>å†…å®¹</label>
        <textarea id="contentInput" placeholder="å†™ä¸‹ä½ çš„æƒ³æ³•å’Œæ”¶è·..."></textarea>
      </div>

      <div class="grid-2">
        <div class="form-group">
          <label>åˆ†ç±»</label>
          <select id="categoryInput">
            <option value="math">æ•°å­¦</option>
            <option value="language">è¯­è¨€å­¦ä¹ </option>
            <option value="cooking">çƒ¹é¥ª</option>
            <option value="tech">æŠ€æœ¯</option>
            <option value="other">å…¶ä»–</option>
          </select>
        </div>

        <div class="form-group">
          <label>æ—¥æœŸ</label>
          <input type="date" id="dateInput">
        </div>
      </div>

      <div class="form-group">
        <label>é™„ä»¶ï¼ˆæ¨¡æ‹Ÿï¼‰</label>
        <input type="file" id="fileInput" multiple>
        <div id="fileList" style="margin-top: 8px; font-size: 14px; color: #6B7280;"></div>
      </div>

      <button class="btn btn-success" onclick="addRecord()" id="saveBtn">
        ğŸ’¾ ä¿å­˜è®°å½•
      </button>
    </div>

    <!-- è®°å½•åˆ—è¡¨ -->
    <div id="recordsList"></div>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <div class="stats" id="stats"></div>
  </div>

  <script>
    // åˆ†ç±»é…ç½®
    const categories = {
      math: { name: 'æ•°å­¦', class: 'cat-math' },
      language: { name: 'è¯­è¨€å­¦ä¹ ', class: 'cat-language' },
      cooking: { name: 'çƒ¹é¥ª', class: 'cat-cooking' },
      tech: { name: 'æŠ€æœ¯', class: 'cat-tech' },
      other: { name: 'å…¶ä»–', class: 'cat-other' }
    };

    // åˆå§‹åŒ–
    let records = [];
    let selectedFiles = [];
    let deferredPrompt;

    // PWAå®‰è£…åŠŸèƒ½
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('installBanner').classList.add('show');
    });

    document.getElementById('installButton').addEventListener('click', async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
          document.getElementById('installBanner').classList.remove('show');
        }
        deferredPrompt = null;
      }
    });

    document.getElementById('closeBanner').addEventListener('click', () => {
      document.getElementById('installBanner').classList.remove('show');
    });

    // æ³¨å†ŒService Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(() => console.log('âœ… Service Worker æ³¨å†ŒæˆåŠŸ'))
        .catch((err) => console.log('Service Worker æ³¨å†Œå¤±è´¥:', err));
    }

    // åŠ è½½æ•°æ®
    function loadRecords() {
      const saved = localStorage.getItem('knowledge-records');
      if (saved) {
        records = JSON.parse(saved);
      }
      renderRecords();
    }

    // ä¿å­˜æ•°æ®
    function saveRecords() {
      localStorage.setItem('knowledge-records', JSON.stringify(records));
    }

    // åˆ‡æ¢è¡¨å•æ˜¾ç¤º
    function toggleForm() {
      const form = document.getElementById('formCard');
      form.classList.toggle('hidden');
      if (!form.classList.contains('hidden')) {
        document.getElementById('titleInput').focus();
      }
    }

    // æ·»åŠ è®°å½•
    function addRecord() {
      const title = document.getElementById('titleInput').value.trim();
      const content = document.getElementById('contentInput').value.trim();
      const category = document.getElementById('categoryInput').value;
      const date = document.getElementById('dateInput').value;

      if (!title || !content) {
        alert('è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹ï¼');
        return;
      }

      const record = {
        id: Date.now().toString(),
        title: title,
        content: content,
        category: category,
        date: date,
        files: selectedFiles,
        createdAt: new Date().toISOString()
      };

      records.unshift(record);
      saveRecords();
      clearForm();
      toggleForm();
      renderRecords();
    }

    // æ¸…ç©ºè¡¨å•
    function clearForm() {
      document.getElementById('titleInput').value = '';
      document.getElementById('contentInput').value = '';
      document.getElementById('categoryInput').value = 'math';
      document.getElementById('dateInput').value = new Date().toISOString().split('T')[0];
      document.getElementById('fileInput').value = '';
      document.getElementById('fileList').textContent = '';
      selectedFiles = [];
    }

    // åˆ é™¤è®°å½•
    function deleteRecord(id) {
      if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
        records = records.filter(r => r.id !== id);
        saveRecords();
        renderRecords();
      }
    }

    // æ¸²æŸ“è®°å½•åˆ—è¡¨
    function renderRecords() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const categoryFilter = document.getElementById('categoryFilter').value;
      const dateFilter = document.getElementById('dateFilter').value;

      let filtered = records.filter(record => {
        const matchSearch = record.title.toLowerCase().includes(searchTerm) ||
                          record.content.toLowerCase().includes(searchTerm);
        const matchCategory = categoryFilter === 'all' || record.category === categoryFilter;
        const matchDate = !dateFilter || record.date === dateFilter;
        return matchSearch && matchCategory && matchDate;
      });

      const container = document.getElementById('recordsList');
      
      if (filtered.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            ${records.length === 0 ? 'è¿˜æ²¡æœ‰è®°å½•ï¼Œå¼€å§‹æ·»åŠ å§ï¼' : 'æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è®°å½•'}
          </div>
        `;
      } else {
        container.innerHTML = filtered.map(record => {
          const cat = categories[record.category];
          return `
            <div class="record-card">
              <div class="record-header">
                <div style="flex: 1;">
                  <div class="record-title">${escapeHtml(record.title)}</div>
                  <div class="record-meta">
                    <span class="category-tag ${cat.class}">${cat.name}</span>
                    <span>ğŸ“… ${record.date}</span>
                  </div>
                </div>
                <button class="delete-btn" onclick="deleteRecord('${record.id}')">ğŸ—‘ï¸</button>
              </div>
              <div class="record-content">${escapeHtml(record.content)}</div>
              ${record.files && record.files.length > 0 ? `
                <div class="record-files">
                  <strong>ğŸ“ é™„ä»¶:</strong> ${record.files.join(', ')}
                </div>
              ` : ''}
            </div>
          `;
        }).join('');
      }

      // æ›´æ–°ç»Ÿè®¡
      const stats = document.getElementById('stats');
      let statsText = `å…±æœ‰ <strong>${records.length}</strong> æ¡è®°å½•`;
      if (categoryFilter !== 'all') {
        statsText += ` | å½“å‰åˆ†ç±»: ${categories[categoryFilter].name}`;
      }
      if (searchTerm) {
        statsText += ` | æœç´¢ç»“æœ: ${filtered.length} æ¡`;
      }
      stats.innerHTML = statsText;
    }

    // è½¬ä¹‰HTML
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // æ–‡ä»¶é€‰æ‹©
    document.getElementById('fileInput').addEventListener('change', function(e) {
      selectedFiles = Array.from(e.target.files).map(f => f.name);
      document.getElementById('fileList').textContent = 
        selectedFiles.length > 0 ? 'å·²é€‰æ‹©: ' + selectedFiles.join(', ') : '';
    });

    // æœç´¢å’Œè¿‡æ»¤ç›‘å¬
    document.getElementById('searchInput').addEventListener('input', renderRecords);
    document.getElementById('categoryFilter').addEventListener('change', renderRecords);
    document.getElementById('dateFilter').addEventListener('change', renderRecords);

    // è¡¨å•éªŒè¯
    document.getElementById('titleInput').addEventListener('input', updateSaveBtn);
    document.getElementById('contentInput').addEventListener('input', updateSaveBtn);

    function updateSaveBtn() {
      const title = document.getElementById('titleInput').value.trim();
      const content = document.getElementById('contentInput').value.trim();
      document.getElementById('saveBtn').disabled = !title || !content;
    }

    // åˆå§‹åŒ–æ—¥æœŸ
    document.getElementById('dateInput').value = new Date().toISOString().split('T')[0];

    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    window.addEventListener('load', function() {
      loadRecords();
      console.log('âœ… PWAåº”ç”¨å·²åŠ è½½ï¼');
    });
  </script>
</body>
</html>